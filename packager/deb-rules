#!/usr/bin/make -f


MALEF_FLAGS=-XMALEF_BUILD_MODE=optimize			\
		-XMALEF_SYSTEM=linux								\
		-XMALEF_SUBSYSTEM=ansi							\
		-XMALEF_PYTHON_VERSION=$(shell python3 -c \
			'import sys; print(".".join(map(str, sys.version_info[0:2])))')

PREFIX=$(shell pwd)/pkg/malef

%:
	dh $@

clean:
	dh_testdir
	dh_testroot
	gprclean -Pmake_all
	dh_clean

override_dh_auto_build:
	gprbuild -v -p -Pmake_all ${MALEF_FLAGS}
	gnatdoc -bplwPmalef --enable-build ${MALEF_FLAGS}

override_dh_auto_install:
	gprinstall -v -f -p -Pmalef --prefix=debian/malef/usr ${MALEF_FLAGS} 		\
		--install-name=malef
	gprinstall -v -f -p -Pc_malef --prefix=debian/c-malef/usr ${MALEF_FLAGS}	\
		--install-name=c_malef
	gprinstall -v -f -p -Ppy_malef --prefix=debian/py-malef/usr ${MALEF_FLAGS}	\
		--install-name=py_malef --mode=usage
	gprinstall -v -f -p -Pmalef_subsystems --prefix=debian/malef_ansi				\
		${MALEF_FLAGS}	\
		--install-name=malef_subsystems --mode=usage
	mkdir -pv debian/malef-doc-html/usr/share/doc/malef-doc-html
	cp -rv alire/docs debian/malef-doc-html/usr/share/doc/malef-doc-html/


# debuild -us -uc

